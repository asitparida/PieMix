!function(){"use strict";function e(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"_"+e()}String.prototype.capitalizeFirstLetter=function(){return this.charAt(0).toUpperCase()+this.slice(1)},String.prototype.replaceAll=function(e,t){var n=new RegExp(e,"g");return this.replace(n,t)},angular.module("piemix.modules",["ngSanitize","ui.bootstrap"]).directive("pieMix",["$parse",function(t){return{restrict:"AEC",scope:{slices:"=",config:"=",callbackOnClick:"&"},templateUrl:"template/piemix/template.html",controller:["$scope","$timeout","$element","$attrs","$parse",function(t,n,r,i,a){var o=this;o._generateCoordinates=function(e,t,n){var r=e+"deg_"+t+"_rad"+n.toString();if("undefined"!=typeof o.coordinates[r]&&null!=o.coordinates[r])return o.coordinates[r];var i=0,a=0,c=Math.abs(t*Math.sin(.0174533*e)),d=Math.abs(t*Math.cos(.0174533*e));return e>=0&&90>=e?(i=n.x+c,a=n.y-d):e>=90&&180>=e?(i=n.x+c,a=n.y+d):e>=180&&270>=e?(i=n.x-c,a=n.y+d):(i=n.x-c,a=n.y-d),o.coordinates[r]={x:Math.ceil(i),y:Math.ceil(a)},o.coordinates[r]},o._generatePies=function(t,n,r){var i=_.reduce(t,function(e,t){return e+t.value},0),a=0;_.each(t,function(t,c){for(var d=0,l=o.baseRadius,u=o.baseRadius;n-1>d;)u*=o.radiusIncrementFactor,l+=u,d+=1;var s=360;"undefined"!=typeof r&&null!=r&&"undefined"!=typeof r.deg&&null!=r.deg&&(s=r.deg);var g=Math.ceil(t.value/i*s),f=a+g,h=a+g+("undefined"!=typeof t.degStart&&null!=t.degStart&&t.degStart!={}?t.degStart:0),x=a+(h-a)/2,y=o._generateCoordinates(a,l,o.centerXY),p=o._generateCoordinates(x,l,o.centerXY),C=o._generateCoordinates(h,l,o.centerXY),v=0;g>180&&(v=1),t._uid=e(),t.rad=l,t.deg=g,t.degStart=f-g,t.effectiveDeg=h,t.midDeg=x,t.degEnd=f,t.startXY=y,t.midXY=p,t.endXY=C,t.pathCoeff=v,t.activecolor=t.color,t.priority=n;var m="";m=360!=t.effectiveDeg?"M"+t.startXY.x+" "+t.startXY.y+" A "+t.rad+" "+t.rad+", 0, "+t.pathCoeff+", 1, "+t.endXY.x+" "+t.endXY.y+" L "+o.centerXY.x+" "+o.centerXY.y+" Z":"M "+o.centerXY.x+" "+o.centerXY.y+" m "+-t.rad+" 0 a "+t.rad+" "+t.rad+" 0 1 1 "+2*t.rad+" 0 a "+t.rad+" "+t.rad+" 0 1 1 "+-(2*t.rad)+" 0",t.d=m;var S=_.clone(t);delete S.child,o.generatedPies.push(S),"undefined"!=typeof t.child&&t.child!={}&&t.child.length>0&&o._generatePies(t.child,n+1,t),a=f})},o._calDeepLength=function(e){var t=0;return e.length>0&&(t+=1),_.each(e,function(e){"undefined"!=typeof e.child&&e.child!={}&&e.child.length>0&&(t+=o._calDeepLength(e.child))}),t},o._calMaxRadius=function(e){for(var t=o._calDeepLength(e),n=o.baseRadius,r=0;t-1>r;)n+=o.baseRadius*o.radiusIncrementFactor,r+=1;return n},o.getContainerWidth=function(){return"undefined"!=typeof r&&null!=r?r.width():2*o._maxRad},o.getContainerHeight=function(){return"undefined"!=typeof r&&null!=r?r.height():2*o._maxRad},o._getCenterXY=function(e,t){o._maxRad=o._calMaxRadius(e);var n=o.getContainerWidth()/2;return t="undefined"!==t&&t!={}&&null!=t?t:0,{x:n,y:o._maxRad+2*t}},o._calcQuadrants=function(){var e={},t=o.getContainerWidth(),n=(o.getContainerHeight(),o.centerXY),r=o.gapToLabel,i=o._maxRad;return t-30>=i+r?(e.NE={x:n.x+i+r,y:10},e.NW={x:n.x-i-r,y:10},e.SE={x:n.x+i+r,y:n.y},e.SW={x:n.x-i-r,y:n.y},e):void 0},o._getQuadrantKey=function(e){var t="";return e>=0&&90>=e?t="NE":e>90&&180>=e?t="SE":e>180&&270>=e?t="SW":e>270&&360>=e&&(t="NW"),t},o._drawHelpBoxes=function(){var e={NE:0,SE:0,NW:0,SW:0},t=50,n=_.sortBy(angular.copy(o.generatedPies),function(e){return-e.priority}),r=o._calcQuadrants();_.each(n,function(n){e.id=n.id;var i=o._getQuadrantKey(n.midDeg),a=_.clone(r[i]);if(a.y=a.y+e[i],"NE"==i||"SE"==i){var c={x:a.x,y:a.y},d={x:a.x+100,y:a.y},l=n.midXY;n._ptr=l.x+","+l.y+" "+c.x+","+c.y+" "+d.x+","+d.y,n.colorBox={x:c.x,y:c.y+8},n.textBox={x:c.x+24,y:c.y+20},n.incr=e[i]}else if("NW"==i||"SW"==i){var c={x:a.x,y:a.y},d={x:a.x-100,y:a.y},l=n.midXY;n._ptr=d.x+","+d.y+" "+c.x+","+c.y+" "+l.x+","+l.y,n.colorBox={x:c.x-100,y:c.y+8},n.textBox={x:c.x-100+24,y:c.y+20},n.incr=e[i]}e[i]=e[i]+t;var u=_.find(o.generatedPies,function(e){return 0==e._uid.localeCompare(n._uid)});"undefined"!=typeof u&&null!=u&&u!={}&&(u.colorBox=n.colorBox,u.textBox=n.textBox,u.ptr=n._ptr,u.fillOpacity=1)})},o._startGenerating=function(t){o.generatedPies=[],o.centerXY=o._getCenterXY(t,5),o.svgWidth=o.getContainerWidth(),o.svgHeight=2*o._maxRad+100,o._generatePies(t,1,null),1==o.showStrokeCircleAtCenter&&(o.strokeCircle={cx:o.centerXY.x,cy:o.centerXY.y,r:.5*o.baseRadius,fill:o.strokeColor});({_uid:e(),activecolor:o.strokeColor,color:o.strokeColor});n(o._drawHelpBoxes,500)},o._init=function(e){this.baseRadius=angular.copy(o.config.baseRadius)||100,this.radiusIncrementFactor=angular.copy(o.config.radiusIncrementFactor)||.66,this.gapToLabel=angular.copy(o.config.gapToLabel)||60,this.strokeColor=angular.copy(o.config.strokeColor)||"#fff",this.strokeWidth=angular.copy(o.config.strokeWidth)||0,this.showLabels=angular.copy(o.config.showLabels),this.showStrokeCircleAtCenter=angular.copy(o.config.showStrokeCircleAtCenter),o.coordinates={},o.generatedPies=[],o.centerXY={},o._maxRad={},o._startGenerating(e)},o.pieSliceClicked=function(e){o.callbackOnClick({data:e}),"function"==typeof o.config.pieSliceClicked&&o.config.pieSliceClicked({data:e})},o.config.highlightPie=function(e){_.each(o.generatedPies,function(t){t.id==e&&(t.activecolor="#000")})},o.config.dehighlightPie=function(e){_.each(o.generatedPies,function(t){t.id==e&&(t.activecolor=t.color)})}}],controllerAs:"piemixctrl",bindToController:!0,replace:!0,link:function(e,n,r,i){var a=[];angular.forEach(["slices","config"],function(n){if(r[n]){t(r[n]);a.push(e.$parent.$watch(angular.bind(i,function(){return this[n]}),function(e){i._init(angular.copy(i.slices))},!0))}})}}}])}();
!function(){"use strict";var t={pieMixMasterTmpl:'        <div class="pie-mix-holder" ng-style="{\'height\': piemixctrl.svgHolderHeight + \'px\'}">            <svg height="{{piemixctrl.svgHeight}}" width="{{piemixctrl.svgWidth}}" version="1.1" xmlns="http://www.w3.org/2000/svg">                <path tabindex="0" ng-attr-d="{{path.d}}" ng-attr-priority="{{path.priority}}" ng-style="{\'fill\' : path.activecolor, \'stroke\':piemixctrl.strokeColor, \'stroke-width\':piemixctrl.strokeWidth}" ng-repeat="path in piemixctrl.generatedPies  | orderBy:\'priority\':\'false\'" ng-click="piemixctrl.pieSliceClicked(path)" ng-mouseenter="path.activecolor = \'#000\'" ng-mouseleave="path.activecolor = path.color"/>                <rect ng-if="piemixctrl.showLabels != false" ng-attr-x="{{path.colorBox.x}}" ng-attr-y="{{path.colorBox.y}}" width="15" height="15" style="fill-opacity:0;" ng-click="piemixctrl.pieSliceClicked(path)" ng-style="{\'fill\': path.activecolor, \'fill-opacity\': path.fillOpacity}" ng-repeat="path in piemixctrl.generatedPies  | orderBy:\'priority\':\'false\'" ng-mouseenter="path.activecolor = \'#000\'" ng-mouseleave="path.activecolor = path.color"/>                <text ng-if="piemixctrl.showLabels != false" ng-attr-x="{{path.textBox.x}}" ng-attr-y="{{path.textBox.y}}" ng-repeat="path in piemixctrl.generatedPies  | orderBy:\'priority\':\'false\'">{{path.title}}</text>                <polyline ng-if="piemixctrl.showLabels != false" ng-attr-points="{{path.ptr}}" fill="none" stroke="#000" ng-attr-stroke-width="{{path.activecolor != \'#000\' ? 1 : 2}}" ng-attr-stroke-opacity="{{path.activecolor != \'#000\' ? 0.50 : 1}}" stroke-linecap="round" stroke-dasharray="1, 5" ng-repeat="path in piemixctrl.generatedPies  | orderBy:\'priority\':\'false\'"/>                <circle ng-if="piemixctrl.showStrokeCircleAtCenter == true" ng-attr-cx="{{piemixctrl.strokeCircle.cx}}" ng-attr-cy="{{piemixctrl.strokeCircle.cy}}" ng-attr-r="{{piemixctrl.strokeCircle.r}}" ng-style="{\'fill\' : piemixctrl.strokeCircle.fill, \'stroke\':piemixctrl.strokeColor, \'stroke-width\':piemixctrl.strokeWidth}"/>            </svg>        </div>    '};angular.module("piemix.modules").run(["$templateCache",function(e){e.put("template/piemix/template.html",t.pieMixMasterTmpl)}])}();